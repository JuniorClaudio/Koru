<!-- /* 

=========================================================================== 
Koru GPL Source Code 
Copyright (C) 2017 Tekton Labs
This file is part of the Koru GPL Source Code.
Koru Source Code is free software: you can redistribute it and/or modify 
it under the terms of the GNU General Public License as published by 
the Free Software Foundation, either version 3 of the License, or 
(at your option) any later version. 

Koru Source Code is distributed in the hope that it will be useful, 
but WITHOUT ANY WARRANTY; without even the implied warranty of 
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the 
GNU General Public License for more details. 

You should have received a copy of the GNU General Public License 
along with Koru Source Code. If not, see <http://www.gnu.org/licenses/>. 
=========================================================================== 

*/ -->

<div class="panel">
  <div class="panel-heading">
    <h3 class="panel-title"><%= t "refuges.needs" %></h3>
    <hr>
  </div>
  <div class="panel-body">
    <% if refuge.last_questionnaire.nil? %>
      <%= t "refuges.no_questionnaire_registered" %>
    <% else %>
      <% if refuge.last_questionnaire.needs.blank? %>
        <%= t "refuges.no_needs_registered" %>
      <% else %>
        <table id="needs-table" width="100%">
          <% refuge.last_questionnaire.needs.group_by{|x| x.entity}.each do |entity| %>
            <th colspan="2" class="th-header-styles"><%= entity.first.name %></th>
            <% entity.second.each do |need| %>
              <tr>
                <td class="td-vertical-align"><i class="glyphicon glyphicon-remove-sign item-status <%= entity_color(need.entity) %>"></i></td>
                <td><b><%= need.title %></b></td>
                <td class="td-vertical-align td-text-align">
                  <% any_engagement = need.first_in_engagement_list %>
                  <% if any_engagement.nil? %>
                    <%= link_to t("refuges.needs_assign"), new_front_refuge_need_assignment_path(refuge, need) %>
                  <% else %>
                    <a class="ui blue tag label"><%= any_engagement.person_in_charge.organization.truncate(20) %></a>
                  <% end %>
                </td>
              </tr>
              <tr>
                <td></td>
                <td><p class="item-description"><%= need.description %></p></td>
                <td></td>
              </tr>
            <% end %>
          <% end %>
        </table>
      <% end %>
    <% end %>
  </div>
</div>