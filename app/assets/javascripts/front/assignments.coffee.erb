document.addEventListener "turbolinks:load", ->
  if $("#locale").val() == "es"
    organization_message_error = 'El campo organización responsable es requerido'
    responsabilities_message_error = 'El campo responsabilidades es requerido'
    name_message_error = 'El campo persona responsable es requerido'
    phone_message_error = 'El campo celular es requerido'
    email_message_error = 'El campo correo electrónico es requerido'
    range_dates = "La fecha final debe ser mayor a la fecha inicial!"
    dates_must_exists = "Los campos fecha inicial y fecha final son requeridos"
    unique_date_must_exists = "El campo fecha única es requerido"
  else
    organization_message_error = 'Responsabilities is required'
    responsabilities_message_error = 'Organization responsable is required'
    name_message_error = 'Person responsable is required'
    phone_message_error = 'Phone is required'
    email_message_error = 'Email is required'
    range_dates = "End date must be greater than start date!"
    dates_must_exists = "Start date and end date is required"
    unique_date_must_exists = "Unique date is required"
  process = (date) ->
    parts = date.split('/')
    new Date(parts[2], parts[1] - 1, parts[0])
  $('#form-organization').form
    on: 'blur'
    fields:
      'person_in_charge[organization]': 'empty'
      'person_in_charge[responsabilities]': 'empty'
  $('#form-engagement').form
    on: 'blur'
    fields:
      'person_in_charge[engagements_attributes][0][start_date]': 'empty'
      'person_in_charge[engagements_attributes][0][end_date]': 'empty'
  $('#form-person').form
    on: 'blur'
    fields:
      'person_in_charge[name]': 'empty'
      'person_in_charge[phone]': 'empty'
      'person_in_charge[email]': [
        'email'
        'empty'
      ]
  $('.ui.checkbox').checkbox()
  $('#person_in_charge_phone').inputmask '999 999 999', 'placeholder': ''
  $('#engagement-unique-date').prop 'disabled', true
  ct = 0
  $('.datepicker').datepicker
    format: 'dd/mm/yyyy'
    orientation: 'bottom auto'
    startDate: 'dateToday'
  $('#engagement-unique-date').datepicker
    format: 'dd/mm/yyyy'
    startDate: 'dateToday'
  $('#person_in_charge_organization').on 'focusout', ->
    if $('#person_in_charge_organization').val() == ''
      $('.organization-alert-error').html organization_message_error
      $('.organization-alert-error').removeClass('hide')
      return
  $('#person_in_charge_responsabilities').on 'focusout', ->
    if $('#person_in_charge_responsabilities').val() == ''
      $('.responsabilities-alert-error').html responsabilities_message_error
      $('.responsabilities-alert-error').removeClass('hide')
      return
  $('#person_in_charge_name').on 'focusout', ->
    if $('#person_in_charge_name').val() == ''
      $('.name-alert-error').html name_message_error
      $('.name-alert-error').removeClass('hide')
      return
  $('#person_in_charge_phone').on 'focusout', ->
    if $('#person_in_charge_phone').val() == ''
      $('.phone-alert-error').html phone_message_error
      $('.phone-alert-error').removeClass('hide')
      return
  $('#person_in_charge_email').on 'focusout', ->
    if $('#person_in_charge_email').val() == ''
      $('.email-alert-error').html email_message_error
      $('.email-alert-error').removeClass('hide')
      return
  $('#person_in_charge_organization').on 'focus', ->
    $('.organization-alert-error').addClass 'hide'
    return
  $('#person_in_charge_responsabilities').on 'focus', ->
    $('.responsabilities-alert-error').addClass 'hide'
    return
  $('#person_in_charge_name').on 'focus', ->
    $('.name-alert-error').addClass 'hide'
    return
  $('#person_in_charge_phone').on 'focus', ->
    $('.phone-alert-error').addClass 'hide'
    return
  $('#person_in_charge_email').on 'focus', ->
    $('.email-alert-error').addClass 'hide'
    return
  $('#engagement-unique-date').on 'focus', ->
    $('#engagement-unique-date').parents('.field').removeClass 'error'
    $('#unique-date-error').addClass('hide')
    return
  $('#engagement-start-date').on 'focus', ->
    $('#error-description').addClass 'hide'
    return
  $('#engagement-end-date').on 'focus', ->
    $('#error-description').addClass 'hide'
    return
  $('#checkbox-unique-date').change ->
    if $('#checkbox-unique-date').is(':checked')
      $('#engagement-start-date').parents('.field').removeClass 'error'
      $('#engagement-end-date').parents('.field').removeClass 'error'
      $('#engagement-start-date').prop 'disabled', true
      $('#engagement-end-date').prop 'disabled', true
      $('#engagement-unique-date').prop 'disabled', false
      $('#engagement-start-date').val ''
      $('#engagement-end-date').val ''
    else
      $('#engagement-unique-date').parents('.field').removeClass 'error'
      $('#engagement-start-date').prop 'disabled', false
      $('#engagement-end-date').prop 'disabled', false
      $('#engagement-unique-date').val ''
      $('#engagement-unique-date').prop 'disabled', true
    return
  $('.next1').on 'click', (e) ->
    e.preventDefault()
    if $('#form-organization').form('is valid')
      $('#organization-container').animate 'slow', ->
        if ct > 0
          $('#organization-container').removeClass 'transition visible'
          $('#organization-container').addClass 'transition hidden'
        $('#organization-container').css 'display', 'none'
        $('#step-organization').removeClass 'active'
        $('#step-organization').addClass 'completed'
        $('#step-engagement').removeClass 'disabled'
        $('#step-engagement').addClass 'active'
        $('#engagement-container').transition 'fly right'
        ct++
        return
    else
      if $('#person_in_charge_organization').val() == ''
        $('#person_in_charge_organization').parents('.field').addClass 'error'
        $('.organization-alert-error').html organization_message_error
        $('.organization-alert-error').removeClass('hide')
      if $('#person_in_charge_responsabilities').val() == ''
        $('#person_in_charge_responsabilities').parents('.field').addClass 'error'
        $('.responsabilities-alert-error').html responsabilities_message_error
        $('.responsabilities-alert-error').removeClass('hide')
    return
  $('.prev1').on 'click', (e) ->
    e.preventDefault()
    $('#step-organization').removeClass 'completed'
    $('#step-organization').addClass 'active'
    $('#step-engagement').removeClass 'active'
    $('#step-engagement').addClass 'disabled'
    $('#engagement-container').animate 'slow', ->
      $('#engagement-container').transition 'hide'
      $('#organization-container').transition 'fly right'
      return
    return
  $('.next2').on 'click', (m) ->
    m.preventDefault()
    if $('#checkbox-unique-date').is(':checked')
      if $('#engagement-unique-date').val() == ''
        $('#engagement-unique-date').parents('.field').addClass 'error'
        $('#unique-date-error label').html unique_date_must_exists
        $('#unique-date-error').removeClass('hide')
      else
        $('#step-engagement').removeClass 'active'
        $('#step-engagement').addClass 'completed'
        $('#step-person').removeClass 'disabled'
        $('#step-person').addClass 'active'
        $('#engagement-container').animate 'slow', ->
          $('#engagement-container').transition 'hide'
          $('#person-container').transition 'fly right'
          return
    else
      if $('#engagement-start-date').val() == '' or $('#engagement-end-date').val() == ''
        $('#error-description').removeClass 'hide'
        $('#error-description label').html dates_must_exists
        if $('#engagement-start-date').val() == ''
          $('#engagement-start-date').parents('.field').addClass 'error'
        if $('#engagement-end-date').val() == ''
          $('#engagement-end-date').parents('.field').addClass 'error'
      else if $('#engagement-start-date').val() != '' and $('#engagement-end-date').val() != ''
        input_start_date = $('#engagement-start-date').val()
        input_end_date = $('#engagement-end-date').val()
        if process(input_end_date) < process(input_start_date)
          $('#engagement-start-date').parents('.field').addClass 'error'
          $('#engagement-end-date').parents('.field').addClass 'error'
          $('#error-description').removeClass 'hide'
          $('#error-description label').html range_dates
        else
          $('#step-engagement').removeClass 'active'
          $('#step-engagement').addClass 'completed'
          $('#step-person').removeClass 'disabled'
          $('#step-person').addClass 'active'
          $('#engagement-container').animate 'slow', ->
            $('#engagement-container').transition 'hide'
            $('#person-container').transition 'fly right'
            return
      else
        $('#step-engagement').removeClass 'active'
        $('#step-engagement').addClass 'completed'
        $('#step-person').removeClass 'disabled'
        $('#step-person').addClass 'active'
        $('#engagement-container').animate 'slow', ->
          $('#engagement-container').transition 'hide'
          $('#person-container').transition 'fly right'
          return
    return
  $('.prev2').on 'click', (m) ->
    m.preventDefault()
    $('#step-engagement').removeClass 'completed'
    $('#step-engagement').addClass 'active'
    $('#step-person').removeClass 'active'
    $('#step-person').addClass 'disabled'
    $('#person-container').animate 'slow', ->
      $('#person-container').transition 'hide'
      $('#engagement-container').transition 'fly right'
      return
    return
  $('.submit').on 'click', (p) ->
    p.preventDefault()
    if $('#form-person').form('is valid')
      $('#new_person_in_charge').submit()
    else
      if $('#person_in_charge_name').val() == ''
        $('#person_in_charge_name').parents('.field').addClass 'error'
        $('.name-alert-error').html name_message_error
        $('.name-alert-error').removeClass('hide')
      if $('#person_in_charge_phone').val() == ''
        $('#person_in_charge_phone').parents('.field').addClass 'error'
        $('.phone-alert-error').html phone_message_error
        $('.phone-alert-error').removeClass('hide')
      if $('#person_in_charge_email').val() == ''
        $('#person_in_charge_email').parents('.field').addClass 'error'
        $('.email-alert-error').html email_message_error
        $('.email-alert-error').removeClass('hide')
    return
  return